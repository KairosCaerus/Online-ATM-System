<!DOCTYPE html>
<html>

<head>
  <title>Opening and Closing Bank Accounts</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <center>
  <img src="BOR_Logo.png"
   width="300" height="100"/>
   <br>
  </center>

  <body style="background-color:rgb(244, 226, 198)">

  <br>
  <h1 class ="custom">Managing Accounts</h1>

  <script>
    function checkCookies() {
      var cookArr = document.cookie.split(';')
      for(var i = 0; i < cookArr.length; i++){
        var pair = cookArr[i].split("=");
        if(pair[0].trim() == "loggedin"){
          if (pair[1].trim() != "true") {
            alert("Error 404, Login not found. Please login again")
            window.location.href = "Signin.html";
          }
          else{
            for(var j = 0; j < cookArr.length; j++){
              var pair2 = cookArr[j].split("=");
              if(pair2[0].trim() == "user"){
                getData(pair2[1].trim());
              }
            }
          }
        }
      }
    }
  </script>
  <body onload ="checkCookies()">
  <script>
    async function getData(username){
      console.log(username)
      fetch('http://localhost:5000/users/accounts?' + new URLSearchParams({
        "user" : username
      }), {method: 'GET'})
      .then((test) => test.json())
      .then((data) => {
        document.getElementById("username").innerHTML = username;
        loadData(data);
      });
    }
    function loadData(data){
      console.log(data);
      var col = [];
      for (var i = 1; i < data.length; i++){
        for (var key in data[i]){
          if (col.indexOf(key) === -1){
            col.push(key)
          }
        }
      }
      var table = document.createElement("table");
      var tr = table.insertRow(-1);
      for(var i = 0; i < col.length; i++){
        var th = document.createElement("th");
        th.innerHTML = col[i];
        tr.appendChild(th);
      }
      for (var i = 1; i < data.length; i++){
        tr = table.insertRow(-1);
        for (var j = 0; j < col.length; j++){
          var tabcell = tr.insertCell(-1);
          tabcell.innerHTML = data[i][col[j]];
        }
      }

      var divContainer = dataTable;
      divContainer.innerHTML = "";
      divContainer.appendChild(table);
    }
    </script>

  <div id="button"><a href="AccountOpen.html">Create a New Account</a></div>
  <div id="button"><a href="AccountClose.html">Delete an Existing Account</a></div>

</body>


<!--- Hey I think the API is missing a delete account function
<script>
  async function deleteAccount(){
    fetch('http://localhost:5000/users/login?' + new URLSearchParams({
      "user" : user.value,
      "pass" : pass.value
    }), {method: 'GET'})
    .then((test) => test.json())
    .then((data) => {
      checkLogin(data)
    });
  }
</script>
-->

</html>
